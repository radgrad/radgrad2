

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> ui/components/admin/analytics/newsletter/utilities/newsletter.ts</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    API Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Namespaces</h3><ul><li><a href="api_academic-term.html">api/academic-term</a></li><li><a href="api_base.html">api/base</a></li><li><a href="api_career.html">api/career</a></li><li><a href="api_course.html">api/course</a></li><li><a href="api_degree-plan.html">api/degree-plan</a></li><li><a href="api_ice.html">api/ice</a></li><li><a href="api_integrity.html">api/integrity</a></li><li><a href="api_interest.html">api/interest</a></li><li><a href="api_level.html">api/level</a></li><li><a href="api_opportunity.html">api/opportunity</a></li><li><a href="api_radgrad.html">api/radgrad</a></li><li><a href="api_review.html">api/review</a></li><li><a href="api_role.html">api/role</a></li><li><a href="api_slug.html">api/slug</a></li><li><a href="api_star.html">api/star</a></li><li><a href="api_teaser.html">api/teaser</a></li><li><a href="api_test.html">api/test</a></li><li><a href="api_user.html">api/user</a></li><li><a href="api_user-interaction.html">api/user-interaction</a></li><li><a href="api_verification.html">api/verification</a></li><li><a href="ui_pages_admin.html">ui/pages/admin</a></li></ul><h3>Classes</h3><ul><li><a href="api_academic-term.AcademicTermCollection.html">AcademicTermCollection</a></li><li><a href="api_base.BaseCollection.html">BaseCollection</a></li><li><a href="api_base.BaseSlugCollection.html">BaseSlugCollection</a></li><li><a href="api_base.BaseTypeCollection.html">BaseTypeCollection</a></li><li><a href="api_career.CareerGoalCollection.html">CareerGoalCollection</a></li><li><a href="api_course.CourseCollection.html">CourseCollection</a></li><li><a href="api_course.CourseInstanceCollection.html">CourseInstanceCollection</a></li><li><a href="api_degree-plan.AcademicYearInstanceCollection.html">AcademicYearInstanceCollection</a></li><li><a href="api_degree-plan.exports.PlanChoiceCollection.html">exports.PlanChoiceCollection</a></li><li><a href="api_degree-plan.PreferredChoice.html">PreferredChoice</a></li><li><a href="api_interest.InterestCollection.html">InterestCollection</a></li><li><a href="api_interest.InterestTypeCollection.html">InterestTypeCollection</a></li><li><a href="api_opportunity.OpportunityCollection.html">OpportunityCollection</a></li><li><a href="api_opportunity.OpportunityInstanceCollection.html">OpportunityInstanceCollection</a></li><li><a href="api_opportunity.OpportunityTypeCollection.html">OpportunityTypeCollection</a></li><li><a href="api_public-stats.PublicStatsCollection.html">PublicStatsCollection</a></li><li><a href="api_radgrad.RadGradClass.html">RadGradClass</a></li><li><a href="api_review.ReviewCollection.html">ReviewCollection</a></li><li><a href="api_slug.SlugCollection.html">SlugCollection</a></li><li><a href="api_teaser.TeaserCollection.html">TeaserCollection</a></li><li><a href="api_user.AdminProfileCollection.html">AdminProfileCollection</a></li><li><a href="api_user.AdvisorProfileCollection.html">AdvisorProfileCollection</a></li><li><a href="api_user.BaseProfileCollection.html">BaseProfileCollection</a></li><li><a href="api_user.FacultyProfileCollection.html">FacultyProfileCollection</a></li><li><a href="api_user.StudentProfileCollection.html">StudentProfileCollection</a></li><li><a href="api_user.UserCollection.html">UserCollection</a></li><li><a href="api_user-interaction.UserInteractionCollection.html">UserInteractionCollection</a></li><li><a href="api_verification.VerificationRequestCollection.html">VerificationRequestCollection</a></li><li><a href="Checklist.html">Checklist</a></li><li><a href="EditReviewButton.html">EditReviewButton</a></li><li><a href="FirstMenu.html">FirstMenu</a></li><li><a href="IceHeader.html">IceHeader</a></li><li><a href="LandingCourseExplorerPage.html">LandingCourseExplorerPage</a></li><li><a href="MenuIceCircle.html">MenuIceCircle</a></li><li><a href="ProfileCareerGoalCollection.html">ProfileCareerGoalCollection</a></li><li><a href="ProfileCourseCollection.html">ProfileCourseCollection</a></li><li><a href="ProfileInterestCollection.html">ProfileInterestCollection</a></li><li><a href="ProfileOpportunityCollection.html">ProfileOpportunityCollection</a></li><li><a href="RadGradPropertiesClass.html">RadGradPropertiesClass</a></li><li><a href="startup_server.RadGradForecastsClass.html">RadGradForecastsClass</a></li><li><a href="TabIceCircle.html">TabIceCircle</a></li><li><a href="ui_pages_admin.AdminAnalyticsNewsletterPage.html">AdminAnalyticsNewsletterPage</a></li><li><a href="ui_pages_admin.AdminDataModelAcademicTermsPage.html">AdminDataModelAcademicTermsPage</a></li><li><a href="ui_pages_admin.AdminDataModelAcademicYearsPage.html">AdminDataModelAcademicYearsPage</a></li><li><a href="UserInteractionManager.html">UserInteractionManager</a></li></ul><h3>Interfaces</h3><ul><li><a href="AdminAnalyticsNewsletterWidgetProps.html">AdminAnalyticsNewsletterWidgetProps</a></li><li><a href="Html.html">Html</a></li><li><a href="UIMSnapshot.html">UIMSnapshot</a></li></ul><h3>Global</h3><ul><li><a href="global.html#AdminProtectedRoute">AdminProtectedRoute</a></li><li><a href="global.html#BehaviorTable">BehaviorTable</a></li><li><a href="global.html#CareerGoalLabel">CareerGoalLabel</a></li><li><a href="global.html#CompletedVerificationsWidget">CompletedVerificationsWidget</a></li><li><a href="global.html#CourseLabel">CourseLabel</a></li><li><a href="global.html#defineAcademicTermsForYear">defineAcademicTermsForYear</a></li><li><a href="global.html#descriptionPairs">descriptionPairs</a></li><li><a href="global.html#ensureFutureAcademicTerms">ensureFutureAcademicTerms</a></li><li><a href="global.html#EventVerificationsWidget">EventVerificationsWidget</a></li><li><a href="global.html#EXPLORER_FILTER_KEYS">EXPLORER_FILTER_KEYS</a></li><li><a href="global.html#EXPLORER_SORT_KEYS">EXPLORER_SORT_KEYS</a></li><li><a href="global.html#EXPLORER_TYPE">EXPLORER_TYPE</a></li><li><a href="global.html#EXPLORER_TYPE_ICON">EXPLORER_TYPE_ICON</a></li><li><a href="global.html#generatePublicProfileDataObject">generatePublicProfileDataObject</a></li><li><a href="global.html#getCourseNumber">getCourseNumber</a></li><li><a href="global.html#getMostPopular">getMostPopular</a></li><li><a href="global.html#getPlanCount">getPlanCount</a></li><li><a href="global.html#getPublicProfileData">getPublicProfileData</a></li><li><a href="global.html#getRandomCourseSlug">getRandomCourseSlug</a></li><li><a href="global.html#getRandomCourseSlugForDept">getRandomCourseSlugForDept</a></li><li><a href="global.html#getRandomDepartment">getRandomDepartment</a></li><li><a href="global.html#getSimpleChoiceNumber">getSimpleChoiceNumber</a></li><li><a href="global.html#getTermsAndConditions">getTermsAndConditions</a></li><li><a href="global.html#getWhatsNew">getWhatsNew</a></li><li><a href="global.html#InterestLabel">InterestLabel</a></li><li><a href="global.html#itemTitle">itemTitle</a></li><li><a href="global.html#itemTitleString">itemTitleString</a></li><li><a href="global.html#LandingNavBar">LandingNavBar</a></li><li><a href="global.html#makeSampleCareerGoal">makeSampleCareerGoal</a></li><li><a href="global.html#makeSampleCareerGoalArray">makeSampleCareerGoalArray</a></li><li><a href="global.html#makeSampleCareerGoalSlugArray">makeSampleCareerGoalSlugArray</a></li><li><a href="global.html#makeSampleCourseSlugArray">makeSampleCourseSlugArray</a></li><li><a href="global.html#makeSampleInterestArray">makeSampleInterestArray</a></li><li><a href="global.html#makeSampleInterestSlugArray">makeSampleInterestSlugArray</a></li><li><a href="global.html#makeSampleOpportunitySlugArray">makeSampleOpportunitySlugArray</a></li><li><a href="global.html#makeSampleUserArray">makeSampleUserArray</a></li><li><a href="global.html#normalInitialization">normalInitialization</a></li><li><a href="global.html#NotAuthorizedPage">NotAuthorizedPage</a></li><li><a href="global.html#NotFoundPage">NotFoundPage</a></li><li><a href="global.html#OpportunityLabel">OpportunityLabel</a></li><li><a href="global.html#PAGEIDS">PAGEIDS</a></li><li><a href="global.html#PendingVerificationsWidget">PendingVerificationsWidget</a></li><li><a href="global.html#PictureField">PictureField</a></li><li><a href="global.html#processBulkStarCsvData">processBulkStarCsvData</a></li><li><a href="global.html#ProtectedRoute">ProtectedRoute</a></li><li><a href="global.html#RadGradForecasts">RadGradForecasts</a></li><li><a href="global.html#routes">routes</a></li><li><a href="global.html#schema">schema</a></li><li><a href="global.html#sendEmail">sendEmail</a></li><li><a href="global.html#setPublicProfileData">setPublicProfileData</a></li><li><a href="global.html#setupMailURL">setupMailURL</a></li><li><a href="global.html#SigninPage">SigninPage</a></li><li><a href="global.html#SignoutDidntAgreeToTermsPage">SignoutDidntAgreeToTermsPage</a></li><li><a href="global.html#SignoutPage">SignoutPage</a></li><li><a href="global.html#sleep">sleep</a></li><li><a href="global.html#TermsAndConditionsPage">TermsAndConditionsPage</a></li><li><a href="global.html#testModeInitialization">testModeInitialization</a></li><li><a href="global.html#USER_INTERACTION_DESCRIPTIONS">USER_INTERACTION_DESCRIPTIONS</a></li><li><a href="global.html#validateCourseSlugFormat">validateCourseSlugFormat</a></li><li><a href="global.html#VISIBILITY">VISIBILITY</a></li><li><a href="global.html#WHATS_NEW_FIELDS">WHATS_NEW_FIELDS</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>ui/components/admin/analytics/newsletter/utilities/newsletter.ts</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import _ from 'lodash';
import { StudentProfiles } from '../../../../../../api/user/StudentProfileCollection';
import { CourseInstance, Opportunity, OpportunityInstance, StudentProfile } from '../../../../../../typings/radgrad';
import { Users } from '../../../../../../api/user/UserCollection';
import { Courses } from '../../../../../../api/course/CourseCollection';
import { CourseInstances } from '../../../../../../api/course/CourseInstanceCollection';
import { Opportunities } from '../../../../../../api/opportunity/OpportunityCollection';
import { OpportunityInstances } from '../../../../../../api/opportunity/OpportunityInstanceCollection';
import { AcademicTerms } from '../../../../../../api/academic-term/AcademicTermCollection';
import { Slugs } from '../../../../../../api/slug/SlugCollection';
import { Reviews } from '../../../../../../api/review/ReviewCollection';
import { COLORS } from '../../../../../utilities/Colors';

/** @namespace ui.components.admin.analytics.newsletter.utilities */

interface Html {
  header?: string;
  info?: string;
}

export interface EmailData {
  to: string | string[];
  bcc: string | string[];
  from: string;
  replyTo: string | string[];
  subject: string;
  templateData: {
    adminMessage: any;
    firstName: string;
    firstRec: Html | string;
    secondRec: Html | string;
    thirdRec: Html | string;
  }
  filename: string;
}

const iceMap = {
  i: {
    name: 'Innovation', color: COLORS.GREEN,
    low: 'You are lacking in Innovation! Consider adding some research opportunities or other' +
      ' innovation-related activities to strengthen this area.',
    med: 'You are showing growth in Innovation. Consider adding some research opportunities or other' +
      ' innovation-related activities to strengthen this area.',
    high: 'You are close to achieving 100 points in Innovation! Add a few more innovation-related opportunities' +
      ' to top this area off.',
  },
  c: {
    name: 'Competency', color: COLORS.NAVY,
    low: 'You are lacking in Competency. Go to your Degree Planner and flesh out your academic plan by adding' +
      ' more courses to strengthen this area.',
    med: 'You are showing some Competency in your degree plan. Go to your Degree Planner and flesh out your' +
      ' academic plan by adding more courses.',
    high: 'You are showing great Competency! Add a few more courses to get to 100 points.',
  },
  e: {
    name: 'Experience', color: COLORS.PURPLE,
    low: 'You are lacking in Experience! Add some profession-related opportunities to show' +
      ' that you are ready to work in a professional environment.',
    med: 'You have some professional development in your degree plan. To increase your Experience points' +
      ' and show that you are ready to work in a professional environment, add some profession-related' +
      ' opportunities.',
    high: 'You are showing a great amount of Experience in your degree plan! Add a few more' +
      ' profession-related opportunities to top this area off and reach 100 Experience points!',
  },
};

const levelMap = {
  1: 'You are currently level 1. To get to level 2, finish your first semester of ICS' +
    ' coursework and then go see your advisor to confirm the completion of your courses and pick up' +
    ' a new laptop sticker!',
  2: 'You are currently level 2. To get to the next level, complete your second semester of ICS' +
    ' coursework, though that alone may not be enough! Venture out and complete some opportunities, get them' +
    ' verified by your advisor, and then you may find yourself at the next level.',
  3: 'Now that you are well into your academic career, it\'s time to plan further' +
    ' ahead. Complete your degree plan by adding enough courses and opportunities to reach 100 ICE points. Finish' +
    ' a bit more coursework and get a few more verified opportunities, and you\'ll get to level 4! Don\'t forget' +
    ' to update your RadGrad profile too... That new sticker depends on it.',
  4: 'At level 4, you have not only shown great competency through your coursework, but you have also shown' +
    ' innovation and experience through your opportunities. Continue with your curriculum, focus on verifying even' +
    ' more opportunities, and help your peers out by leaving reviews for courses and opportunities' +
    ' that you have completed. By doing so, you may find yourself at a rare level.',
  5: 'You are a veteran in the ICS community. The finish line is in sight, at least for your undergraduate career.' +
    ' But don\'t slow down! Take part in more opportunities to really show that you are ready for a professional life' +
    ' after college, and don\'t forget to leave more reviews to help guide your peers to the next level. There is a' +
    ' possibility that at the end of all this, you will achieve the rarest RadGrad honor.',
  6: 'You have reached the level of ICS elites. At level 6, you have shown that there is little holding you back' +
    ' from a successful future in computer science, whether it\'s joining the workforce or entering Graduate School.' +
    ' Congratulations on your journey! If you have not already done so, pick up your new RadGrad sticker and show it' +
    ' off proudly!',
};

const iceRecHelper = (student: StudentProfile, value, component): string => {
  let html = '';
  if (value >= 100) {
    html += `Congratulations! You have achieved 100 ${iceMap[component].name} points!`;
    return html;
  }
  if (value &lt; 30) {
    html += iceMap[component].low;
  } else if (value &lt; 60) {
    html += iceMap[component].med;
  } else {
    html += iceMap[component].high;
  }
  const studentInterests = Users.getInterestIDs(student.userID);
  if (component === 'c') {
    if (studentInterests.length === 0) {
      html += ' &lt;em>&lt;a href="https://radgrad.ics.hawaii.edu">' +
        ' Add some interests so we can provide course recommendations!&lt;/a>&lt;/em>';
      return html;
    }
    const relevantCourses = Courses.find().fetch().filter((course) => _.some(course.interestIDs, interest => _.includes(studentInterests, interest)));
    const currentCourses = CourseInstances.find({ studentID: student.userID }).fetch().map((ci) => ci.courseID);
    const recommendedCourses = relevantCourses.filter(course => !_.includes(currentCourses, course._id));
    if (recommendedCourses.length === 0) {
      html += '&lt;em>&lt;a href="https://radgrad.ics.hawaii.edu">' +
        ' Add more interests so we can provide course recommendations!&lt;/a>&lt;/em>';
      return html;
    }
    const recCourse = recommendedCourses[0];
    html += ' Check out';
    html += '&lt;a style={{color:COLORS.GREEN; font-weight: bold}}' +
      ` href="https://radgrad.ics.hawaii.edu/student/${student.username}` +
      `/explorer/courses/${Courses.findSlugByID(recCourse._id)}"> ${recCourse.shortName}&lt;/a>`;
  } else {
    if (studentInterests.length === 0) {
      html += ' &lt;em>&lt;a href="https://radgrad.ics.hawaii.edu">' +
        ' Add some Interests to your profile so we can provide opportunity recommendations!&lt;/a>&lt;/em>';
      return html;
    }
    const opps = Opportunities.find().fetch().filter((opp) => opp.ice[component] > 0);
    const relevantOpps = opps.filter((opp) => _.some(opp.interestIDs, interest => _.includes(studentInterests, interest)));
    if (relevantOpps.length === 0) {
      return ' &lt;em>&lt;a href="https://radgrad.ics.hawaii.edu">' +
        ' Add more Interests to your profile so we can provide opportunity recommendations!&lt;/a>&lt;/em>';
    }
    const currentOpps = OpportunityInstances.find({ studentID: student.userID }).fetch().map((oi) => oi.opportunityID);
    const recommendedOpps = relevantOpps.filter(opp => !_.includes(currentOpps, opp._id));
    let recOpp;
    if (recommendedOpps.length === 0) {
      recOpp = relevantOpps[0];
    } else {
      recOpp = recommendedOpps[0];
    }
    html += ' Check out';
    html += '&lt;a style="color: #6FBE44; font-weight: bold;"' +
      ` href="https://radgrad.ics.hawaii.edu/student/${student.username}` +
      `/explorer/opportunities/${Opportunities.findSlugByID(recOpp._id)}"> ${recOpp.name}&lt;/a>`;
  }
  return html;
};

const iceRecommendation = (student: StudentProfile): Html | string => {
  const ice = StudentProfiles.getProjectedICE(student.username);
  if (ice.i >= 100 &amp;&amp; ice.c >= 100 &amp;&amp; ice.e >= 100) {
    return '';
  }
  const html: Html = {};
  html.header = 'Finish Your Degree Plan';
  html.info = '&lt;p>To achieve a complete degree plan, obtain 100 points in each ICE component!&lt;/p>';
  // CAM ice is an object.
  _.each(ice, (value, component) => {
    let iceLevel;
    if (value &lt; 30) {
      iceLevel = '&lt;span style={COLORS.RED}>&lt;strong>NEEDS WORK&lt;/strong>&lt;/span>';
    } else if (value &lt; 60) {
      iceLevel = '&lt;span style={COLORS.ORANGE}>&lt;strong>NEEDS WORK&lt;/strong>&lt;/span>';
    } else {
      iceLevel = '&lt;span style={COLORS.GREEN}>&lt;strong>GOOD&lt;/strong>&lt;/span>';
    }
    html.info += `&lt;p>&lt;span style="color: ${iceMap[component].color}">${iceMap[component].name} (${value} points)&lt;/span>
      : ${iceLevel}&lt;/p>`;
    html.info += `&lt;ul>&lt;li>${iceRecHelper(student, value, component)}&lt;/li>&lt;/ul>`;
  });
  return html;
};

const verifyOppRecommendation = (student: StudentProfile): Html | string => {
  const unverifiedOpps: OpportunityInstance[] = OpportunityInstances.find({
    studentID: student.userID,
    verified: false,
  }).fetch();
  const currentUnverifiedOpps = unverifiedOpps.filter((unverifiedOpp) => {
    const { termID } = unverifiedOpp;
    const { termNumber } = AcademicTerms.findOne({ _id: termID });
    return termNumber &lt;= AcademicTerms.getCurrentAcademicTermDoc().termNumber;
  });
  if (currentUnverifiedOpps.length === 0) {
    return '';
  }
  const html: Html = {};
  html.header = 'Verify Your Opportunities';
  html.info = '&lt;p>You have unverified opportunities. To verify them, visit your RadGrad Degree Planner and'
    + ' click on the opportunity with the red question mark.'
    + ' &lt;img src='
    + '"https://radgrad.ics.hawaii.edu/images/help/degree-planner-unverified-opportunity.png" width="100" alt="degree-planner-unverified-opportunity.png"> '
    + 'Select the opportunity you want to verify in your planner'
    + ' and it should be displayed in the Details tab, along with an option at the bottom to request verification.'
    + ' You must supply a brief explanation of how you participated. There may be additional requirements in addition '
    + 'to requesting the verification. Here is a list of'
    + ' past or current opportunities that you have not yet verified:&lt;/p>';
  html.info += '&lt;ul>';
  currentUnverifiedOpps.forEach((unverifiedOpp) => {
    const { termID } = unverifiedOpp;
    const termName = AcademicTerms.toString(termID, false);
    const opp: Opportunity = Opportunities.findOne({ _id: unverifiedOpp.opportunityID });
    const oppSlug = Slugs.getNameFromID(opp.slugID);
    html.info += '&lt;li>&lt;a style={{color:COLORS.GREEN; font-weight: bold}}'
      + ` href="https://radgrad.ics.hawaii.edu/student/${student.username}`
      + `/explorer/opportunities/${oppSlug}">${opp.name} (${termName})&lt;/a>&lt;/li>`;
  });
  html.info += '&lt;/ul>';
  return html;
};

const levelRecommendation = (student: StudentProfile): Html | string => {
  if (student.level > 5) {
    return '';
  }
  const html: Html = {};
  html.header = 'Level Up and Upgrade Your RadGrad Sticker';
  html.info = '&lt;img src='
    + `"https://radgrad.ics.hawaii.edu/images/level-icons/radgrad-level-${student.level}-icon.png"`
    + ' width="100" height="100" style="float: left; margin: 0 10px;" alt="radgrad level icon">';
  html.info += `&lt;p style={{color: COLORS.GREEN}}>&lt;strong>Current Level: ${student.level}&lt;/strong>&lt;/p>`;
  html.info += '&lt;p>&lt;em>Swing by your advisor\'s office or POST 307 to pick up a laptop sticker for'
    + ' your current level if you haven\'t already!&lt;/em>&lt;/p>';
  html.info += `&lt;p>${levelMap[student.level]}&lt;/p>`;
  if (student.level &lt; 6) {
    html.info += '&lt;p>View your &lt;a style={{color:COLORS.GREEN; font-weight: bold}} '
      + `href="https://radgrad.ics.hawaii.edu/student/${student.username}/home/levels">Level Page&lt;/a>`
      + ' to view specific level requirements.&lt;/p>';
  }
  return html;
};

const reviewCourseRecommendation = (student: StudentProfile): Html | string => {
  const courseInstances: CourseInstance[] = CourseInstances.find({
    studentID: student.userID,
    verified: true,
  }).fetch();
  const completedCourses = courseInstances.map((instance) => instance.courseID);
  const nonReviewedCourses = completedCourses.filter((courseID) => !(Reviews.findOne({ studentID: student.userID, revieweeID: courseID })));
  if (nonReviewedCourses.length === 0) {
    return '';
  }
  let suggestedReviewCourses = [];
  const remainingCourses = [];
  nonReviewedCourses.forEach((courseID) => {
    if (Reviews.findOne({ revieweeID: courseID }) === undefined) {
      suggestedReviewCourses.push(courseID);
    } else {
      remainingCourses.push(courseID);
    }
  });
  suggestedReviewCourses = suggestedReviewCourses.concat(remainingCourses);
  const html: Html = {};
  html.header = 'Review Courses You Have Completed';
  html.info = '&lt;p>Contribute to the ICS community by providing reviews for courses you have completed.'
    + ' Here are some suggested courses to review:&lt;/p>';
  html.info += '&lt;ul>';
  suggestedReviewCourses.forEach((courseID, index) => {
    if (index === 3) {
      return false;
    }
    const courseSlug = Slugs.getNameFromID(Courses.findDoc(courseID).slugID);
    const courseName = Courses.findDocBySlug(courseSlug).shortName;
    html.info += '&lt;li>&lt;a style={{color:COLORS.GREEN; font-weight: bold}}'
      + ` href="https://radgrad.ics.hawaii.edu/student/${student.username}`
      + `/explorer/courses/${courseSlug}">${courseName}&lt;/a>&lt;/li>`;
    return true;
  });
  html.info += '&lt;/ul>';
  return html;
};

export const reviewOppRecommendation = (student: StudentProfile): Html | string => {
  const completedOpps = OpportunityInstances.find({ studentID: student.userID, verified: true }).fetch().map((instance) => instance.opportunityID);
  const nonReviewedOpps = completedOpps.filter((oppID) => !(Reviews.findOne({ studentID: student.userID, revieweeID: oppID })));
  if (nonReviewedOpps.length === 0) {
    return '';
  }
  let suggestedReviewOpps = [];
  const remainingOpps = [];
  nonReviewedOpps.forEach((oppID) => {
    if (Reviews.findOne({ revieweeID: oppID }) === undefined) {
      suggestedReviewOpps.push(oppID);
    } else {
      remainingOpps.push(oppID);
    }
  });
  suggestedReviewOpps = suggestedReviewOpps.concat(remainingOpps);
  suggestedReviewOpps = _.uniq(suggestedReviewOpps);
  const html: Html = {};
  html.header = 'Review Opportunities You Have Completed';
  html.info = '&lt;p>Contribute to the ICS community by providing reviews for opportunities you have completed.'
    + ' Here are some suggested opportunities to review:&lt;/p>';
  html.info += '&lt;ul>';
  suggestedReviewOpps.forEach((oppID, index) => {
    if (index === 3) {
      return false;
    }
    const opportunity: Opportunity = Opportunities.findOne({ _id: oppID });
    const oppSlug = Slugs.findDoc(opportunity.slugID).name;
    const oppName = Opportunities.findDocBySlug(oppSlug).name;
    html.info += '&lt;li>&lt;a style={{color:COLORS.GREEN; font-weight: bold}}'
      + ` href="https://radgrad.ics.hawaii.edu/student/${student.username}`
      + `/explorer/opportunities/${oppSlug}">${oppName}&lt;/a>&lt;/li>`;
    return true;
  });
  html.info += '&lt;/ul>';
  return html;
};

// TODO Currently we only use the first 3 of the recommendations for our Newsletter, we need to discuss if we should add more
// or implement a better system such that we can incorporate more recommendations on a rotational/conditional basis
const recList = [iceRecommendation, verifyOppRecommendation, levelRecommendation, reviewCourseRecommendation, reviewOppRecommendation];

export const getRecList = (student: StudentProfile) => {
  const suggestedRecs = [];
  recList.forEach((func) => {
    const html = func(student);
    if (html) {
      suggestedRecs.push(html);
    }
  });
  return suggestedRecs;
};

export const getStudentEmailsByLevel = (level: number): string[] => {
  const studentProfiles = StudentProfiles.find({ level, isAlumni: false }).fetch();
  return studentProfiles.map((p) => p.username);
};
</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by 
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>

</body>
</html>
